var et=Object.defineProperty,tt=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var Ae=(t,n,s)=>n in t?et(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,S=(t,n)=>{for(var s in n||(n={}))st.call(n,s)&&Ae(t,s,n[s]);if(Fe)for(var s of Fe(n))ot.call(n,s)&&Ae(t,s,n[s]);return t},I=(t,n)=>tt(t,nt(n));import{R as e,c as g,r as d,f as he,E as Le,a as ue,b as at,d as Z,e as Ee,u as Ie,g as rt,h as H,i as $e,j as ye,k as ee,l as lt,m as xe,n as ct,o as ge,p as it,q as ut,s as mt,t as re,v as dt,A as ft,F as pt,w as ht,N as Et,x as yt,y as Te,z as xt,H as gt}from"./vendor.1681e672.js";const vt=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=s(a);fetch(a.href,r)}};vt();function ne(){return navigator.userAgent==="ClashX Runtime"}let k=null;class wt{constructor(n){this.instance=null,window.WebViewJavascriptBridge!=null&&(this.instance=window.WebViewJavascriptBridge),this.initBridge(s=>{this.instance=s,n()})}initBridge(n){if(!ne())return n==null?void 0:n(null);if(window.WebViewJavascriptBridge!=null)return n(window.WebViewJavascriptBridge);if(window.WVJBCallbacks!=null)return window.WVJBCallbacks.push(n);window.WVJBCallbacks=[n];const s=document.createElement("iframe");s.style.display="none",s.src="https://__bridge_loaded__",document.documentElement.appendChild(s),setTimeout(()=>document.documentElement.removeChild(s),0)}async callHandler(n,s){return await new Promise(o=>{var a;(a=this.instance)==null||a.callHandler(n,s,o)})}async ping(){return await this.callHandler("ping")}async readConfigString(){return await this.callHandler("readConfigString")}async getPasteboard(){return await this.callHandler("getPasteboard")}async getAPIInfo(){return await this.callHandler("apiInfo")}async setPasteboard(n){return await this.callHandler("setPasteboard",n)}async writeConfigWithString(n){return await this.callHandler("writeConfigWithString",n)}async setSystemProxy(n){return await this.callHandler("setSystemProxy",n)}async getStartAtLogin(){return await this.callHandler("getStartAtLogin")}async getProxyDelay(n){return await this.callHandler("speedTest",n)}async setStartAtLogin(n){return await this.callHandler("setStartAtLogin",n)}async isSystemProxySet(){return await this.callHandler("isSystemProxySet")}}function Ct(t){if(k!=null){t();return}k=new wt(t)}function K(t){const{title:n,children:s,className:o,style:a}=t;return e.createElement("header",{className:g("header",o),style:a},e.createElement("h1",{className:"md:text-xl"},n),e.createElement("div",{className:"flex flex-auto items-center justify-end"},s))}function z(t){const{type:n,size:s=14,className:o,style:a}=t,r=g("clash-iconfont",`icon-${n}`,o),l=S({fontSize:s},a),c=I(S({},t),{className:r,style:l});return e.createElement("i",S({},c))}function G(){}function Nt(t,n){const s=[],o=[];for(const a of t)n(a)?s.push(a):o.push(a);return[s,o]}function V(t){const n=["B","KB","MB","GB","TB"];let s=0;for(;~~(t/1024)&&s<n.length;)t/=1024,s++;return`${s===0?t:t.toFixed(2)} ${n[s]}`}function ve(t){const{className:n,checked:s=!1,disabled:o=!1,onChange:a=G}=t,r=g("switch",{checked:s,disabled:o},n);function l(){o||a(!s)}return e.createElement("div",{className:r,onClick:l},e.createElement(z,{className:"switch-icon font-bold",type:"check",size:20}))}const J=d.exports.forwardRef((t,n)=>{const{className:s,style:o,children:a}=t;return e.createElement("div",{className:g("card",s),style:o,ref:n},a)});function Be(t){const{options:n,value:s,onSelect:o}=t;return e.createElement("div",{className:"button-select"},n.map(a=>e.createElement("button",{value:a.value,key:a.value,className:g("button-select-options",{actived:s===a.value}),onClick:()=>o==null?void 0:o(a.value)},a.label)))}const bt={SideBar:{Proxies:"Proxies",Overview:"Overview",Logs:"Logs",Rules:"Rules",Settings:"Setting",Connections:"Connections",Version:"Version"},Settings:{title:"Settings",labels:{startAtLogin:"Start at login",language:"language",setAsSystemProxy:"Set as system proxy",allowConnectFromLan:"Allow connect from Lan",proxyMode:"Mode",socks5ProxyPort:"Socks5 proxy port",httpProxyPort:"HTTP proxy port",mixedProxyPort:"Mixed proxy port",externalController:"External controller"},values:{cn:"\u4E2D\u6587",en:"English",global:"Global",rules:"Rules",direct:"Direct",script:"Script"},versionString:"Current ClashX is the latest version\uFF1A{{version}}",checkUpdate:"Check Update",externalControllerSetting:{title:"External Controller",note:"Please note that modifying this configuration will only configure Dashboard. Will not modify your Clash configuration file. Please make sure that the external controller address matches the address in the Clash configuration file, otherwise, Dashboard will not be able to connect to Clash.",host:"Host",port:"Port",secret:"Secret"}},Logs:{title:"Logs"},Rules:{title:"Rules",providerTitle:"Providers",providerUpdateTime:"Last updated at",ruleCount:"Rule count"},Connections:{title:"Connections",keepClosed:"Keep closed connections",total:{text:"total",upload:"upload",download:"download"},closeAll:{title:"Warning",content:"This would close all connections"},filter:{all:"All"},columns:{host:"Host",network:"Network",type:"Type",chains:"Chains",rule:"Rule",time:"Time",speed:"Speed",upload:"Upload",download:"Download",sourceIP:"Source IP"},info:{title:"Connection",id:"ID",host:"Host",hostEmpty:"Empty",dstIP:"IP",dstIPEmpty:"Empty",srcIP:"Source",upload:"Upload",download:"Download",network:"Network",inbound:"Inbound",rule:"Rule",chains:"Chains",status:"Status",opening:"Open",closed:"Closed",closeConnection:"Close"}},Proxies:{title:"Proxies",editDialog:{title:"Edit Proxy",color:"Color",name:"Name",type:"Type",server:"Server",port:"Port",password:"Password",cipher:"Cipher",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"Policy Group",providerTitle:"Providers",providerUpdateTime:"Last updated at",expandText:"Expand",collapseText:"Collapse",speedTestText:"Speed Test",breakConnectionsText:"Close connections which include the group"},Modal:{ok:"Ok",cancel:"Cancel"}},Pt={SideBar:{Proxies:"\u4EE3\u7406",Overview:"\u603B\u89C8",Logs:"\u65E5\u5FD7",Rules:"\u89C4\u5219",Settings:"\u8BBE\u7F6E",Connections:"\u8FDE\u63A5",Version:"\u7248\u672C"},Settings:{title:"\u8BBE\u7F6E",labels:{startAtLogin:"\u5F00\u673A\u65F6\u542F\u52A8",language:"\u8BED\u8A00",setAsSystemProxy:"\u8BBE\u7F6E\u4E3A\u7CFB\u7EDF\u4EE3\u7406",allowConnectFromLan:"\u5141\u8BB8\u6765\u81EA\u5C40\u57DF\u7F51\u7684\u8FDE\u63A5",proxyMode:"\u4EE3\u7406\u6A21\u5F0F",socks5ProxyPort:"Socks5 \u4EE3\u7406\u7AEF\u53E3",httpProxyPort:"HTTP \u4EE3\u7406\u7AEF\u53E3",mixedProxyPort:"\u6DF7\u5408\u4EE3\u7406\u7AEF\u53E3",externalController:"\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E"},values:{cn:"\u4E2D\u6587",en:"English",global:"\u5168\u5C40",rules:"\u89C4\u5219",direct:"\u76F4\u8FDE",script:"\u811A\u672C"},versionString:"\u5F53\u524D ClashX \u5DF2\u662F\u6700\u65B0\u7248\u672C\uFF1A{{version}}",checkUpdate:"\u68C0\u67E5\u66F4\u65B0",externalControllerSetting:{title:"\u7F16\u8F91\u5916\u90E8\u63A7\u5236\u8BBE\u7F6E",note:"\u8BF7\u6CE8\u610F\uFF0C\u4FEE\u6539\u8BE5\u914D\u7F6E\u9879\u5E76\u4E0D\u4F1A\u4FEE\u6539\u4F60\u7684 Clash \u914D\u7F6E\u6587\u4EF6\uFF0C\u8BF7\u786E\u8BA4\u4FEE\u6539\u540E\u7684\u5916\u90E8\u63A7\u5236\u5730\u5740\u548C Clash \u914D\u7F6E\u6587\u4EF6\u5185\u7684\u5730\u5740\u4E00\u81F4\uFF0C\u5426\u5219\u4F1A\u5BFC\u81F4 Dashboard \u65E0\u6CD5\u8FDE\u63A5\u3002",host:"Host",port:"\u7AEF\u53E3",secret:"\u5BC6\u94A5"}},Logs:{title:"\u65E5\u5FD7"},Rules:{title:"\u89C4\u5219",providerTitle:"\u89C4\u5219\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",ruleCount:"\u89C4\u5219\u6761\u6570"},Connections:{title:"\u8FDE\u63A5",keepClosed:"\u4FDD\u7559\u5173\u95ED\u8FDE\u63A5",total:{text:"\u603B\u91CF",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D"},closeAll:{title:"\u8B66\u544A",content:"\u5C06\u4F1A\u5173\u95ED\u6240\u6709\u8FDE\u63A5"},filter:{all:"\u5168\u90E8"},columns:{host:"\u57DF\u540D",network:"\u7F51\u7EDC",type:"\u7C7B\u578B",chains:"\u8282\u70B9\u94FE",rule:"\u89C4\u5219",time:"\u8FDE\u63A5\u65F6\u95F4",speed:"\u901F\u7387",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",sourceIP:"\u6765\u6E90 IP"},info:{title:"\u8FDE\u63A5\u4FE1\u606F",id:"ID",host:"\u57DF\u540D",hostEmpty:"\u7A7A",dstIP:"IP",dstIPEmpty:"\u7A7A",srcIP:"\u6765\u6E90",upload:"\u4E0A\u4F20",download:"\u4E0B\u8F7D",network:"\u7F51\u7EDC",inbound:"\u5165\u53E3",rule:"\u89C4\u5219",chains:"\u4EE3\u7406",status:"\u72B6\u6001",opening:"\u8FDE\u63A5\u4E2D",closed:"\u5DF2\u5173\u95ED",closeConnection:"\u5173\u95ED\u8FDE\u63A5"}},Proxies:{title:"\u4EE3\u7406",editDialog:{title:"\u7F16\u8F91\u4EE3\u7406",color:"\u989C\u8272",name:"\u540D\u5B57",type:"\u7C7B\u578B",server:"\u670D\u52A1\u5668",port:"\u7AEF\u53E3",password:"\u5BC6\u7801",cipher:"\u52A0\u5BC6\u65B9\u5F0F",obfs:"Obfs","obfs-host":"Obfs-host",uuid:"UUID",alterId:"AlterId",tls:"TLS"},groupTitle:"\u7B56\u7565\u7EC4",providerTitle:"\u4EE3\u7406\u96C6",providerUpdateTime:"\u6700\u540E\u66F4\u65B0\u4E8E",expandText:"\u5C55\u5F00",collapseText:"\u6536\u8D77",speedTestText:"\u6D4B\u901F",breakConnectionsText:"\u5207\u6362\u65F6\u6253\u65AD\u5305\u542B\u7B56\u7565\u7EC4\u7684\u8FDE\u63A5"},Modal:{ok:"\u786E \u5B9A",cancel:"\u53D6 \u6D88"}},Re={en_US:bt,zh_CN:Pt},St=Object.keys(Re);function kt(){for(const t of window.navigator.languages){if(t.includes("zh"))return"zh_CN";if(t.includes("us"))return"en_US"}return"en_US"}function we(t){return d.exports.useMemo(()=>{function s(o,a){if(typeof o=="string")t(r=>{const l=o,c=a;r[l]=c});else if(typeof o=="function"){const r=o;t(l=>r(l))}else typeof o=="object"&&t(r=>he(r,l=>{const c=o;for(const u of Object.keys(c)){const h=u;l[h]=c[h]}}))}return s},[t])}class Me{constructor(n){this.EE=new Le,this.innerBuffer=[],this.isClose=!1,this.config=Object.assign({bufferLength:0,retryInterval:5e3,headers:{}},n),this.config.useWebsocket?this.websocketLoop():this.loop()}websocketLoop(){var o;const n=new URL(this.config.url);n.protocol=n.protocol==="http:"?"ws:":"wss:",n.searchParams.set("token",(o=this.config.token)!=null?o:"");const s=new WebSocket(n.toString());s.addEventListener("message",a=>{const r=JSON.parse(a.data);this.EE.emit("data",[r]),this.config.bufferLength>0&&(this.innerBuffer.push(r),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}),s.addEventListener("close",()=>setTimeout(this.websocketLoop,this.config.retryInterval)),s.addEventListener("error",a=>{this.EE.emit("error",a),setTimeout(this.websocketLoop,this.config.retryInterval)})}async loop(){const n=await ue.fromPromise(fetch(this.config.url,{mode:"cors",headers:this.config.token?{Authorization:`Bearer ${this.config.token}`}:{}}),a=>a);if(n.isErr()){this.retry(n.error);return}else if(n.value.body==null){this.retry(new Error("fetch body error"));return}const s=n.value.body.getReader(),o=new TextDecoder;for(;!this.isClose;){const a=await ue.fromPromise(s==null?void 0:s.read(),c=>c);if(a.isErr()){this.retry(a.error);break}const l=o.decode(a.value.value).trim().split(`
`).map(c=>JSON.parse(c));this.EE.emit("data",l),this.config.bufferLength>0&&(this.innerBuffer.push(...l),this.innerBuffer.length>this.config.bufferLength&&this.innerBuffer.splice(0,this.innerBuffer.length-this.config.bufferLength))}}retry(n){this.isClose||(this.EE.emit("error",n),window.setTimeout(()=>{this.loop()},this.config.retryInterval))}subscribe(n,s){this.EE.addListener(n,s)}unsubscribe(n,s){this.EE.removeListener(n,s)}buffer(){return this.innerBuffer.slice()}destory(){this.EE.removeAllListeners(),this.isClose=!0}}class Dt{constructor(n,s){this.axiosClient=at.create({baseURL:n,headers:s?{Authorization:`Bearer ${s}`}:{}})}async getConfig(){return await this.axiosClient.get("configs")}async updateConfig(n){return await this.axiosClient.patch("configs",n)}async getRules(){return await this.axiosClient.get("rules")}async getProxyProviders(){const n=await this.axiosClient.get("providers/proxies",{validateStatus(s){return s>=200&&s<300||s===404}});return n.status===404&&(n.data={providers:{}}),n}async getRuleProviders(){return await this.axiosClient.get("providers/rules")}async updateProvider(n){return await this.axiosClient.put(`providers/proxies/${encodeURIComponent(n)}`)}async updateRuleProvider(n){return await this.axiosClient.put(`providers/rules/${encodeURIComponent(n)}`)}async healthCheckProvider(n){return await this.axiosClient.get(`providers/proxies/${encodeURIComponent(n)}/healthcheck`)}async getProxies(){return await this.axiosClient.get("proxies")}async getProxy(n){return await this.axiosClient.get(`proxies/${encodeURIComponent(n)}`)}async getVersion(){return await this.axiosClient.get("version")}async getProxyDelay(n){return await this.axiosClient.get(`proxies/${encodeURIComponent(n)}/delay`,{params:{timeout:5e3,url:"http://www.gstatic.com/generate_204"}})}async closeAllConnections(){return await this.axiosClient.delete("connections")}async closeConnection(n){return await this.axiosClient.delete(`connections/${n}`)}async getConnections(){return await this.axiosClient.get("connections")}async changeProxySelected(n,s){return await this.axiosClient.put(`proxies/${encodeURIComponent(n)}`,{name:s})}}const Ft=Z(async()=>{if(!ne())return null;const t=await k.getAPIInfo();return{hostname:t.host,port:t.port,secret:t.secret,protocol:"http:"}}),He=Ee("externalControllers",[]);function le(){var h,i,m,E,p,w,F,$,B,P,W,Y,X,q,_;const t=Ie(Ft),n=rt(),s=Ie(He);if(t!=null)return t;let o;{const N=document.querySelector('meta[name="external-controller"]');((h=N==null?void 0:N.content)==null?void 0:h.match(/^https?:/))!=null&&(o=new URL(N.content))}const a=new URLSearchParams(n.search),r=(p=(E=(m=a.get("host"))!=null?m:(i=s==null?void 0:s[0])==null?void 0:i.hostname)!=null?E:o==null?void 0:o.hostname)!=null?p:"127.0.0.1",l=(B=($=(F=a.get("port"))!=null?F:(w=s==null?void 0:s[0])==null?void 0:w.port)!=null?$:o==null?void 0:o.port)!=null?B:"9090",c=(X=(Y=(W=a.get("secret"))!=null?W:(P=s==null?void 0:s[0])==null?void 0:P.secret)!=null?Y:o==null?void 0:o.username)!=null?X:"",u=((q=a.get("protocol"))!=null?q:r==="127.0.0.1")?"http:":(_=o==null?void 0:o.protocol)!=null?_:window.location.protocol;return{hostname:r,port:l,secret:c,protocol:u}}const At=Z({key:"",instance:null});function M(){const{hostname:t,port:n,secret:s,protocol:o}=le(),[a,r]=H(At),l=`${o}//${t}:${n}?secret=${s}`;if(a.key===l)return a.instance;const c=new Dt(`${o}//${t}:${n}`,s);return r({key:l,instance:c}),c}const Ce=Z(!0),Lt=Ee("language",void 0);function D(){const[t,n]=H(Lt),s=d.exports.useMemo(()=>t!=null?t:kt(),[t]),o=d.exports.useCallback(function(a){function r(l){return lt(Re[s][a],l)}return{t:r}},[s]);return{lang:s,locales:St,setLang:n,translation:o}}const Oe=Z({version:"",premium:!1});function me(){const[t,n]=H(Oe),s=M(),o=ye(Ce);return ee([s],async function(){const a=await ue.fromPromise(s.getVersion(),r=>r);o(a.isOk()),n(a.isErr()?{version:"",premium:!1}:{version:a.value.data.version,premium:!!a.value.data.premium})}),t}function Ue(){const[{premium:t}]=H(Oe),n=M(),{data:s,mutate:o}=ee(["/providers/rule",n,t],async()=>{if(!t)return[];const a=await n.getRuleProviders();return Object.keys(a.data.providers).map(r=>a.data.providers[r])});return{providers:s!=null?s:[],update:o}}const It=Ee("profile",{breakConnections:!1});function ze(){const[t,n]=H(It),s=d.exports.useCallback(o=>{n(he(t,o))},[t,n]);return{data:t,set:we(s)}}const We=Z([]);function _e(){const[t,n]=H(We),s=M(),{data:o,mutate:a}=ee(["/providers/proxy",s],async()=>{const r=await s.getProxyProviders();return Object.keys(r.data.providers).map(l=>r.data.providers[l]).filter(l=>l.name!=="default").filter(l=>l.vehicleType!=="Compatible")});return d.exports.useEffect(()=>{n(o!=null?o:[])},[o,n]),{providers:t,update:a}}function Ne(){const t=M(),{data:n,mutate:s}=ee(["/config",t],async()=>{var r;const a=(await t.getConfig()).data;return{port:a.port,socksPort:a["socks-port"],mixedPort:(r=a["mixed-port"])!=null?r:0,redirPort:a["redir-port"],mode:a.mode.toLowerCase(),logLevel:a["log-level"],allowLan:a["allow-lan"]}});return{general:n!=null?n:{},update:s}}const je=$e({proxies:[],groups:[],global:{name:"GLOBAL",type:"Selector",now:"",history:[],all:[]}});function de(){const[t,n]=H(je),s=we(n),o=M(),{mutate:a}=ee(["/proxies",o],async()=>{const l=await o.getProxies(),c=l.data.proxies.GLOBAL;c.name="GLOBAL";const u=new Set(["Selector","URLTest","Fallback","LoadBalance"]),h=new Set(["DIRECT","REJECT","GLOBAL"]),i=c.all.filter(p=>!h.has(p)).map(p=>I(S({},l.data.proxies[p]),{name:p,history:[]})),[m,E]=Nt(i,p=>!u.has(p.type));s({proxies:m,groups:E,global:c})}),r=d.exports.useCallback((l,c)=>{s(u=>{l==="GLOBAL"&&(u.global.now=c);for(const h of u.groups)h.name===l&&(h.now=c)})},[s]);return{proxies:t.proxies,groups:t.groups,global:t.global,update:a,markProxySelected:r,set:s}}const $t=Z(t=>{const n=t(je),s=t(We),o=new Map;for(const a of n.proxies)o.set(a.name,a);for(const a of s)for(const r of a.proxies)o.set(r.name,r);return o});function Ge(){const{data:t,mutate:n}=ee("/clashx",async()=>{var a,r;if(!ne())return{isClashX:!1,startAtLogin:!1,systemProxy:!1};const s=(a=await(k==null?void 0:k.getStartAtLogin()))!=null?a:!1,o=(r=await(k==null?void 0:k.isSystemProxySet()))!=null?r:!1;return{startAtLogin:s,systemProxy:o,isClashX:!0}});return{data:t,update:n}}const Tt=$e([]);function Bt(){const[t,n]=H(Tt),s=we(n),o=M();async function a(){const r=await o.getRules();s(r.data.rules)}return{rules:t,update:a}}const Rt=Z({key:"",instance:null});function Ve(){var i,m;const t=le(),{general:n}=Ne(),s=me(),[o,a]=H(Rt);if(!s.version||!n.logLevel)return null;const r=!!s.version||!0,l=`${t.protocol}//${t.hostname}:${t.port}/logs?level=${(i=n.logLevel)!=null?i:""}&useWebsocket=${r}&secret=${t.secret}`;if(o.key===l)return o.instance;const c=o.instance,u=`${t.protocol}//${t.hostname}:${t.port}/logs?level=${(m=n.logLevel)!=null?m:""}`,h=new Me({url:u,bufferLength:200,token:t.secret,useWebsocket:r});return a({key:l,instance:h}),c!=null&&c.destory(),h}function Mt(){const t=le(),n=me(),s=!!n.version||!0,o=`${t.protocol}//${t.hostname}:${t.port}/connections`;return d.exports.useMemo(()=>n.version?new Me({url:o,bufferLength:200,token:t.secret,useWebsocket:s}):null,[t.secret,o,s,n.version])}function Ht(t){const{className:n,data:s,onClick:o,select:a,canClick:r,errSet:l,rowHeight:c,onSpeedTest:u,proxyMap:h}=t,{translation:i}=D(),{t:m}=i("Proxies"),[E,p]=d.exports.useState(!1),[w,F]=d.exports.useState(!1),$=[],B=N=>{setTimeout(()=>{var A;const C=document.getSelection();if(C===null||C.isCollapsed||C.anchorNode===null||C.focusNode===null||P.current===null||!P.current.contains(C.anchorNode)||!P.current.contains(C.focusNode))return;let T=-1,R=-1;$.forEach((O,U)=>{var j,L,x,Q;((j=O.current)==null?void 0:j.contains(C.anchorNode))&&(T=U,C.anchorOffset===((x=(L=C.anchorNode)==null?void 0:L.textContent)==null?void 0:x.length)&&T++),((Q=O.current)==null?void 0:Q.contains(C.focusNode))&&(R=U,C.focusOffset===0&&R--)}),T!==-1&&R!==-1&&(s.slice(T,R+1).forEach(u),(A=document.getSelection())==null||A.removeAllRanges())},50)},P=d.exports.useRef(null);d.exports.useLayoutEffect(()=>{var N,C;return F(((C=(N=P==null?void 0:P.current)==null?void 0:N.offsetHeight)!=null?C:0)>30),document.addEventListener("mouseup",B,!0),()=>{document.removeEventListener("mouseup",B)}},[]);const W=E?"auto":c,Y=r?o:G;function X(N,C){C.button===1&&(C.preventDefault(),u(N))}function q(){p(!E)}const _=s.map(N=>{var U;const C=(U=h.get(N))==null?void 0:U.history,T=C&&C.length!==0&&C.slice(-1)[0].delay>.001,R=g({"tags-selected":a===N,"cursor-pointer":r,error:l==null?void 0:l.has(N),"has-speed-test-result":T}),A=d.exports.useRef(null);$.push(A);let O="";return T&&(O="<"+(Math.round((C.slice(-1)[0].delay+Number.EPSILON)*100)/100).toString()+"ms>"),e.createElement("li",{className:R,key:N,ref:A,onClick:()=>Y(N),onMouseDown:j=>X(N,j)},N,O===""?"":e.createElement("br",null),O)});return e.createElement("div",{className:g("flex items-start overflow-y-hidden",n),style:{height:W}},e.createElement("ul",{ref:P,className:g("tags",{expand:E})},_),w&&e.createElement("span",{className:"h-7 px-5 select-none cursor-pointer leading-7",onClick:q},m(E?"collapseText":"expandText")))}function se(t){const{className:n,style:s,value:o="",align:a="center",inside:r=!1,autoFocus:l=!1,type:c="text",disabled:u=!1,onChange:h=G,onBlur:i=G,onEnter:m=G}=t,E=g("input",`text-${a}`,{"focus:shadow-none":r},n);function p(w){w.code==="Enter"&&m(w)}return e.createElement("input",{disabled:u,className:E,style:s,value:o,autoFocus:l,type:c,onChange:w=>h(w.target.value,w),onBlur:i,onKeyDown:p})}function Je(t){const{show:n=!0,title:s="Modal",size:o="small",footer:a=!0,onOk:r=G,onClose:l=G,bodyClassName:c,bodyStyle:u,className:h,style:i,children:m}=t,{translation:E}=D(),{t:p}=E("Modal"),w=d.exports.useRef(document.createElement("div")),F=d.exports.useRef(null);d.exports.useLayoutEffect(()=>{const P=w.current;return document.body.appendChild(P),()=>{document.body.removeChild(P)}},[]);function $(P){P.target===F.current&&l()}const B=e.createElement("div",{className:g("modal-mask",{"modal-show":n}),ref:F,onMouseDown:$},e.createElement("div",{className:g("modal",`modal-${o}`,h),style:i},e.createElement("div",{className:"modal-title"},s),e.createElement("div",{className:g("modal-body",c),style:u},m),a&&e.createElement("div",{className:"footer"},e.createElement(be,{onClick:()=>l()},p("cancel")),e.createElement(be,{type:"primary",onClick:()=>r()},p("ok")))));return xe.exports.createPortal(B,w.current)}const Ot={success:"check",info:"info",warning:"info",error:"close"};function Ut(t){const{message:n="",type:s="info",inside:o=!1,children:a,className:r,style:l}=t,c=g("alert",`alert-${o?"note":"box"}-${s}`,r);return e.createElement("div",{className:c,style:l},e.createElement("span",{className:"alert-icon"},e.createElement(z,{type:Ot[s],size:26})),n?e.createElement("p",{className:"alert-message"},n):e.createElement("div",{className:"alert-message"},a))}function be(t){const{type:n="normal",onClick:s=G,children:o,className:a,style:r,disiabled:l}=t,c=g("button",`button-${n}`,a,{"button-disabled":l});return e.createElement("button",{className:c,style:r,onClick:s,disabled:l},o)}function fe(t){const[n,s]=ct(t),o=d.exports.useMemo(()=>{function a(r,l){typeof r=="string"?s(c=>{const u=r,h=l;c[u]=h}):typeof r=="function"?s(r):typeof r=="object"&&s(c=>{const u=r;for(const h of Object.keys(u)){const i=h;c[i]=u[i]}})}return a},[s]);return[n,o]}function zt(t,n=0){if(t.length<2)throw new Error("List requires at least two elements");const[s,o]=d.exports.useState(n);function a(){o((s+1)%t.length)}return{current:d.exports.useMemo(()=>t[s],[t,s]),next:a}}function Pe(t=!1){const[n,s]=d.exports.useState(t);function o(){s(!1)}function a(){s(!0)}return{visible:n,hide:o,show:a}}function Ye(t){const{className:n,checked:s=!1,onChange:o=G}=t,a=g("checkbox",{checked:s},n);function r(){o(!s)}return e.createElement("div",{className:a,onClick:r},e.createElement(z,{className:"checkbox-icon",type:"check",size:18}),e.createElement("div",null,t.children))}function pe(t){const{color:n,className:s,style:o}=t,a=g("tag",s),r=S({color:n},o),l=I(S({},t),{className:a,style:r});return e.createElement("span",S({},l),t.children)}function Wt(t){const n=g("spinner",t.className);return e.createElement("div",{className:n},e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})),e.createElement("div",{className:"spinner-circle"},e.createElement("div",{className:"spinner-inner"})))}function Xe(t){const n=g("loading","visible",t.className);return t.visible?e.createElement("div",{className:n},e.createElement(Wt,{className:t.spinnerClassName})):null}function _t(t){var a,r,l;const n=d.exports.useRef(document.createElement("div"));d.exports.useLayoutEffect(()=>{const c=n.current;return document.body.appendChild(c),()=>{document.body.removeChild(c)}},[]);const s="absolute h-full right-0 transition-transform transform translate-x-full duration-100 pointer-events-auto",o=e.createElement("div",{className:g(t.className,"absolute inset-0 pointer-events-none z-9999")},e.createElement(J,{className:g(s,{"translate-x-0":t.visible}),style:{width:(a=t.width)!=null?a:400}},t.children));return xe.exports.createPortal(o,(l=(r=t.containerRef)==null?void 0:r.current)!=null?l:n.current)}ge.extend(it);function Se(t,n){const s=n==="en_US"?"en":"zh-cn";return ge().locale(s).from(t)}var ke;(function(t){t.Domain="Domain",t.DomainSuffix="DomainSuffix",t.DomainKeyword="DomainKeyword",t.GeoIP="GeoIP",t.IPCIDR="IPCIDR",t.SrcIPCIDR="SrcIPCIDR",t.SrcPort="SrcPort",t.DstPort="DstPort",t.MATCH="MATCH",t.RuleSet="RuleSet"})(ke||(ke={}));function jt(t){const{translation:n}=D(),s=d.exports.useMemo(()=>n("Connections").t,[n]),{className:o,style:a}=t,r=g("flex flex-wrap px-1",o);function l(c){var u;(u=t.onChange)==null||u.call(t,c)}return e.createElement("div",{className:r,style:a},e.createElement("div",{className:g("connections-devices-item pt-2 mb-2",{selected:t.selected===""}),onClick:()=>l("")},s("filter.all")),t.devices.map(c=>e.createElement("div",{key:c.label,className:g("connections-devices-item pt-2 mb-2",{selected:t.selected===c.label}),onClick:()=>l(c.label)},c.label," (",c.number,")")))}function Gt(t){var o,a,r,l,c,u,h,i,m,E,p;const{translation:n}=D(),s=d.exports.useMemo(()=>n("Connections").t,[n]);return e.createElement("div",{className:g(t.className,"text-sm flex flex-col")},e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-16"},s("info.id")),e.createElement("span",{className:"font-mono"},t.connection.id)),e.createElement("div",{className:"flex my-3 justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-16"},s("info.network")),e.createElement("span",{className:"font-mono"},(o=t.connection.metadata)==null?void 0:o.network)),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-16"},s("info.inbound")),e.createElement("span",{className:"font-mono"},(a=t.connection.metadata)==null?void 0:a.type))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-16"},s("info.host")),e.createElement("span",{className:"font-mono flex-1 break-all"},((r=t.connection.metadata)==null?void 0:r.host)?`${t.connection.metadata.host}:${(l=t.connection.metadata)==null?void 0:l.destinationPort}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-16"},s("info.dstIP")),e.createElement("span",{className:"font-mono"},((c=t.connection.metadata)==null?void 0:c.destinationIP)?`${t.connection.metadata.destinationIP}:${(u=t.connection.metadata)==null?void 0:u.destinationPort}`:s("info.hostEmpty"))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-16"},s("info.srcIP")),e.createElement("span",{className:"font-mono"},`${(h=t.connection.metadata)==null?void 0:h.sourceIP}:${(i=t.connection.metadata)==null?void 0:i.sourcePort}`)),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-16"},s("info.rule")),e.createElement("span",{className:"font-mono"},t.connection.rule&&`${t.connection.rule}${t.connection.rulePayload&&`(${t.connection.rulePayload})`}`)),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-16"},s("info.chains")),e.createElement("span",{className:"font-mono flex-1 break-all"},(m=t.connection.chains)==null?void 0:m.slice().reverse().join(" / "))),e.createElement("div",{className:"flex my-3 justify-between"},e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-16"},s("info.upload")),e.createElement("span",{className:"font-mono"},V((E=t.connection.upload)!=null?E:0))),e.createElement("div",{className:"flex flex-1"},e.createElement("span",{className:"font-bold w-16"},s("info.download")),e.createElement("span",{className:"font-mono"},V((p=t.connection.download)!=null?p:0)))),e.createElement("div",{className:"flex my-3"},e.createElement("span",{className:"font-bold w-16"},s("info.status")),e.createElement("span",{className:"font-mono"},t.connection.completed?e.createElement("span",{className:"text-red"},s("info.closed")):e.createElement("span",{className:"text-green"},s("info.opening")))))}class Vt{constructor(){this.connections=new Map,this.saveDisconnection=!1}appendToSet(n){var o;const s=n.reduce((a,r)=>a.set(r.id,r),new Map);for(const a of this.connections.keys())if(!s.has(a))if(!this.saveDisconnection)this.connections.delete(a);else{const r=this.connections.get(a);r!=null&&this.connections.set(a,he(r,l=>{l.completed=!0,l.uploadSpeed=0,l.downloadSpeed=0}))}for(const a of s.keys()){if(!this.connections.has(a)){this.connections.set(a,I(S({},s.get(a)),{uploadSpeed:0,downloadSpeed:0}));continue}const r=this.connections.get(a),l=s.get(a);(o=this.connections)==null||o.set(a,I(S({},l),{uploadSpeed:l.upload-r.upload,downloadSpeed:l.download-r.download}))}}toggleSave(){var n,s;if(this.saveDisconnection){this.saveDisconnection=!1;for(const o of this.connections.keys())((s=(n=this.connections)==null?void 0:n.get(o))==null?void 0:s.completed)&&this.connections.delete(o)}else this.saveDisconnection=!0;return this.saveDisconnection}getConnections(){return[...this.connections.values()]}}function Jt(){const t=d.exports.useMemo(()=>new Vt,[]),n=d.exports.useRef(!0),[s,o]=d.exports.useState([]),[a,r]=d.exports.useState(!1),l=d.exports.useCallback(function(u){t.appendToSet(u),n.current&&o(t.getConnections()),n.current=!n.current},[t]),c=d.exports.useCallback(function(){const u=t.toggleSave();r(u),u||o(t.getConnections()),n.current=!0},[t]);return{connections:s,feed:l,toggleSave:c,save:a}}var y;(function(t){t.Host="host",t.Network="network",t.Type="type",t.Chains="chains",t.Rule="rule",t.Speed="speed",t.Upload="upload",t.Download="download",t.SourceIP="sourceIP",t.Time="time"})(y||(y={}));const Yt=new Set([y.Network,y.Type,y.Rule,y.Speed,y.Upload,y.Download,y.SourceIP,y.Time]);function Xt(t,n){switch(!0){case(t===0&&n===0):return"-";case(t!==0&&n!==0):return`\u2191 ${V(t)}/s \u2193 ${V(n)}/s`;case t!==0:return`\u2191 ${V(t)}/s`;default:return`\u2193 ${V(n)}/s`}}function qt(){const{translation:t,lang:n}=D(),s=d.exports.useMemo(()=>t("Connections").t,[t]),o=Mt(),a=M(),r=d.exports.useRef(null),[l,c]=fe({uploadTotal:0,downloadTotal:0}),{visible:u,show:h,hide:i}=Pe();function m(){a.closeAllConnections().finally(()=>i())}const{connections:E,feed:p,save:w,toggleSave:F}=Jt(),$=d.exports.useMemo(()=>E.map(f=>({id:f.id,host:`${f.metadata.host||f.metadata.destinationIP}:${f.metadata.destinationPort}`,chains:f.chains.slice().reverse().join(" / "),rule:f.rule===ke.RuleSet?`${f.rule}(${f.rulePayload})`:f.rule,time:new Date(f.start).getTime(),upload:f.upload,download:f.download,sourceIP:f.metadata.sourceIP,type:f.metadata.type,network:f.metadata.network.toUpperCase(),speed:{upload:f.uploadSpeed,download:f.downloadSpeed},completed:!!f.completed,original:f})),[E]),B=d.exports.useMemo(()=>{const f=ut(E,"metadata.sourceIP");return Object.keys(f).map(b=>({label:b,number:f[b].length})).sort((b,v)=>b.label.localeCompare(v.label))},[E]),P=d.exports.useRef(null),{x:W}=mt(P),Y=d.exports.useMemo(()=>[{Header:s(`columns.${y.Host}`),accessor:y.Host,minWidth:260,width:260},{Header:s(`columns.${y.Network}`),accessor:y.Network,minWidth:80,width:80},{Header:s(`columns.${y.Type}`),accessor:y.Type,minWidth:120,width:120},{Header:s(`columns.${y.Chains}`),accessor:y.Chains,minWidth:200,width:200},{Header:s(`columns.${y.Rule}`),accessor:y.Rule,minWidth:140,width:140},{id:y.Speed,Header:s(`columns.${y.Speed}`),accessor(f){return[f.speed.upload,f.speed.download]},sortType(f,b){const v=f.original.speed,ae=b.original.speed;return v.download===ae.download?v.upload-ae.upload:v.download-ae.download},minWidth:200,width:200,sortDescFirst:!0},{Header:s(`columns.${y.Upload}`),accessor:y.Upload,minWidth:100,width:100,sortDescFirst:!0},{Header:s(`columns.${y.Download}`),accessor:y.Download,minWidth:100,width:100,sortDescFirst:!0},{Header:s(`columns.${y.SourceIP}`),accessor:y.SourceIP,minWidth:140,width:140,filter:"equals"},{Header:s(`columns.${y.Time}`),accessor:y.Time,minWidth:120,width:120,sortType(f,b){return b.original.time-f.original.time}}],[s]);d.exports.useLayoutEffect(()=>{function f(b){for(const v of b)c({uploadTotal:v.uploadTotal,downloadTotal:v.downloadTotal}),p(v.connections)}return o==null||o.subscribe("data",f),()=>{o==null||o.unsubscribe("data",f),o==null||o.destory()}},[o,p,c]);const{getTableProps:X,getTableBodyProps:q,headerGroups:_,rows:N,prepareRow:C,setFilter:T}=re.exports.useTable({columns:Y,data:$,autoResetSortBy:!1,autoResetFilters:!1,initialState:{sortBy:[{id:y.Time,desc:!1}]}},re.exports.useResizeColumns,re.exports.useBlockLayout,re.exports.useFilters,re.exports.useSortBy),R=d.exports.useMemo(()=>_[0],[_]),A=d.exports.useCallback(function(f){switch(f.column.id){case y.Speed:return Xt(f.value[0],f.value[1]);case y.Upload:case y.Download:return V(f.value);case y.Time:return Se(new Date(f.value),n);default:return f.value}},[n]),[O,U]=d.exports.useState("");function j(f){U(f),T==null||T(y.SourceIP,f||void 0)}const[L,x]=fe({visible:!1,selectedID:"",connection:{}});function Q(f){x({visible:!0,selectedID:f})}function ie(){x(f=>{f.connection.completed=!0}),a.closeConnection(L.selectedID)}const oe=dt(L.connection);return d.exports.useEffect(()=>{var b;const f=(b=$.find(v=>v.id===L.selectedID))==null?void 0:b.original;f?x(v=>{v.connection=S({},f),L.selectedID===oe.current.id&&(v.connection.completed=oe.current.completed)}):Object.keys(oe.current).length!==0&&!oe.current.completed&&x(v=>{v.connection.completed=!0})},[$,L.selectedID,oe,x]),e.createElement("div",{className:"page"},e.createElement(K,{title:s("title")},e.createElement("span",{className:"cursor-default flex-1 connections-filter"},`(${s("total.text")}: ${s("total.upload")} ${V(l.uploadTotal)} ${s("total.download")} ${V(l.downloadTotal)})`),e.createElement(Ye,{className:"connections-filter",checked:w,onChange:F},s("keepClosed")),e.createElement(z,{className:"connections-filter dangerous",onClick:h,type:"close-all",size:20})),B.length>1&&e.createElement(jt,{devices:B,selected:O,onChange:j}),e.createElement(J,{ref:r,className:"connections-card relative"},e.createElement("div",I(S({},X()),{className:"flex flex-col flex-1 w-full overflow-auto",style:{flexBasis:0},ref:P}),e.createElement("div",I(S({},R.getHeaderGroupProps()),{className:"connections-header"}),R.headers.map((f,b)=>{const v=f,ae=v.id;return e.createElement("div",I(S({},v.getHeaderProps()),{className:g("connections-th",{resizing:v.isResizing,fixed:W>0&&v.id===y.Host}),key:ae}),e.createElement("div",S({},v.getSortByToggleProps()),f.render("Header"),v.isSorted?v.isSortedDesc?" \u2193":" \u2191":null),b!==R.headers.length-1&&e.createElement("div",I(S({},v.getResizerProps()),{className:"connections-resizer"})))})),e.createElement("div",I(S({},q()),{className:"flex-1"}),N.map(f=>(C(f),e.createElement("div",I(S({},f.getRowProps()),{className:"cursor-default connections-item select-none",key:f.original.id,onClick:()=>Q(f.original.id)}),f.cells.map(b=>{const v=g("connections-block",{"text-center":Yt.has(b.column.id),completed:f.original.completed},{fixed:W>0&&b.column.id===y.Host});return e.createElement("div",I(S({},b.getCellProps()),{className:v,key:b.column.id}),A(b))}))))))),e.createElement(Je,{title:s("closeAll.title"),show:u,onClose:i,onOk:m},s("closeAll.content")),e.createElement(_t,{containerRef:r,visible:L.visible,width:450},e.createElement("div",{className:"flex h-8 justify-between items-center"},e.createElement("span",{className:"font-bold pl-3"},s("info.title")),e.createElement(z,{type:"close",size:16,className:"cursor-pointer",onClick:()=>x("visible",!1)})),e.createElement(Gt,{className:"mt-3 px-5",connection:L.connection}),e.createElement("div",{className:"flex mt-3 pr-3 justify-end"},e.createElement(be,{type:"danger",disiabled:L.connection.completed,onClick:()=>ie()},s("info.closeConnection")))))}function Kt(){const{translation:t}=D(),{t:n}=t("Settings"),{hostname:s,port:o,secret:a}=le(),[r,l]=H(Ce),[c,u]=fe({hostname:"",port:"",secret:""});d.exports.useEffect(()=>{u({hostname:s,port:o,secret:a})},[s,o,a,u]);const h=ye(He);function i(){const{hostname:m,port:E,secret:p}=c;h([{hostname:m,port:E,secret:p}])}return e.createElement(Je,{show:!r,title:n("externalControllerSetting.title"),bodyClassName:"external-controller",onClose:()=>l(!0),onOk:i},e.createElement(Ut,{type:"info",inside:!0},e.createElement("p",null,n("externalControllerSetting.note"))),e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"font-bold my-1 w-14 md:my-3"},n("externalControllerSetting.host")),e.createElement(se,{className:"flex-1 my-1 md:my-3",align:"left",inside:!0,value:c.hostname,onChange:m=>u("hostname",m),onEnter:i})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"font-bold my-1 w-14 md:my-3"},n("externalControllerSetting.port")),e.createElement(se,{className:"flex-1 my-1 w-14 md:my-3",align:"left",inside:!0,value:c.port,onChange:m=>u("port",m),onEnter:i})),e.createElement("div",{className:"flex items-center"},e.createElement("div",{className:"font-bold my-1 w-14 md:my-3"},n("externalControllerSetting.secret")),e.createElement(se,{className:"flex-1 my-1 w-14 md:my-3",align:"left",inside:!0,value:c.secret,onChange:m=>u("secret",m),onEnter:i})))}function Qt(){var u,h;const t=d.exports.useRef(null),n=d.exports.useRef([]),[s,o]=d.exports.useState([]),{translation:a}=D(),{t:r}=a("Logs"),l=Ve(),c=d.exports.useRef((h=(u=t.current)==null?void 0:u.scrollHeight)!=null?h:0);return d.exports.useLayoutEffect(()=>{var m;const i=t.current;i!=null&&c.current===i.scrollTop+i.clientHeight&&(i.scrollTop=i.scrollHeight-i.clientHeight),c.current=(m=i==null?void 0:i.scrollHeight)!=null?m:0}),d.exports.useEffect(()=>{function i(m){n.current=n.current.slice().concat(m.map(E=>I(S({},E),{time:new Date}))),o(n.current)}return l!=null&&(l.subscribe("data",i),n.current=l.buffer(),o(n.current)),()=>l==null?void 0:l.unsubscribe("data",i)},[l]),e.createElement("div",{className:"page"},e.createElement(K,{title:r("title")}),e.createElement(J,{className:"flex flex-col flex-1 mt-2.5 md:mt-4"},e.createElement("ul",{className:"logs-panel",ref:t},s.map((i,m)=>e.createElement("li",{className:"leading-5 inline-block",key:m},e.createElement("span",{className:"mr-4 text-gray-400 text-opacity-90"},ge(i.time).format("YYYY-MM-DD HH:mm:ss")),e.createElement("span",null,"[",i.type,"] ",i.payload))))))}var te;(function(t){t.SPEED_NOTIFY="speed-notify",t.SPEED_NOTIFY_SINGLE="speed-notify-single"})(te||(te={}));class Zt{constructor(){this.EE=new Le}notifySpeedTest(){this.EE.emit(te.SPEED_NOTIFY)}notifySpeedTestForSingleProxy(n){this.EE.emit(te.SPEED_NOTIFY_SINGLE,n)}subscribe(n,s){this.EE.addListener(n,s)}unsubscribe(n,s){this.EE.removeListener(n,s)}}var ce=new Zt;const qe={"#909399":0,"#00c520":260,"#ff9a28":600,"#ff3e5e":1/0};function Ke(t){const{config:n,className:s}=t,{set:o}=de(),a=M(),r=d.exports.useCallback(async m=>{var p;if(ne())return(p=await(k==null?void 0:k.getProxyDelay(m)))!=null?p:0;const{data:{delay:E}}=await a.getProxyDelay(m);return E},[a]),l=d.exports.useCallback(async function(){console.log("speedtest",n.name),o(p=>{const w=p.proxies.find(F=>F.name===n.name);w!=null&&(w.history.length=0)});const m=await ue.fromPromise(r(n.name),p=>p),E=m.isErr()?0:m.value;o(p=>{const w=p.proxies.find(F=>F.name===n.name);w!=null&&w.history.push({time:Date.now().toString(),delay:E})})},[n.name,r,o]),c=d.exports.useMemo(()=>{var m;return((m=n.history)==null?void 0:m.length)?n.history.slice(-1)[0].delay:0},[n]);d.exports.useLayoutEffect(()=>{const m=()=>{l()};return ce.subscribe(te.SPEED_NOTIFY,m),ce.subscribe(te.SPEED_NOTIFY_SINGLE,E=>{E===n.name&&l()}),()=>{ce.unsubscribe(te.SPEED_NOTIFY,m)}},[l,n.name]);const u=d.exports.useMemo(()=>c===0,[c]),h=d.exports.useMemo(()=>Object.keys(qe).find(m=>c<=qe[m]),[c]),i=u?void 0:h;return e.createElement("div",{className:g("proxy-item",{"proxy-error":u},s)},e.createElement("span",{className:"proxy-type",style:{backgroundColor:i}},n.type),e.createElement("p",{className:"proxy-name"},n.name),e.createElement("p",{className:"proxy-delay"},c===0?"-":`${c}ms`))}function en(t){const{markProxySelected:n}=de(),[s]=H($t),{data:o}=ze(),a=M(),{config:r}=t;async function l(i){if(await a.changeProxySelected(t.config.name,i),n(t.config.name,i),o.breakConnections){const m=[],E=await a.getConnections();for(const p of E.data.connections)p.chains.includes(t.config.name)&&m.push(p.id);await Promise.all(m.map(p=>a.closeConnection(p)))}}async function c(i){ce.notifySpeedTestForSingleProxy(i)}const u=d.exports.useMemo(()=>{var m;const i=new Set;for(const E of r.all){const p=(m=s.get(E))==null?void 0:m.history;(p==null?void 0:p.length)&&p.slice(-1)[0].delay===0&&i.add(E)}return i},[r.all,s]),h=r.type==="Selector";return e.createElement("div",{className:"proxy-group"},e.createElement("div",{className:"flex h-10 mt-4 w-full items-center justify-between md:h-15 md:mt-0 md:w-auto "},e.createElement("span",{className:"h-6 px-5 w-35 overflow-hidden overflow-ellipsis whitespace-nowrap md:w-30"},r.name),e.createElement(pe,{className:"mr-5 md:mr-0"},r.type)),e.createElement("div",{className:"flex-1 py-2 md:py-4"},e.createElement(Ht,{className:"ml-5 md:ml-8",data:r.all,proxyMap:s,onClick:l,errSet:u,select:r.now,canClick:h,onSpeedTest:c,rowHeight:50})))}function tn(t){const{update:n}=_e(),{translation:s,lang:o}=D(),a=M(),{provider:r}=t,{t:l}=s("Proxies"),{visible:c,hide:u,show:h}=Pe();function i(){h(),a.healthCheckProvider(r.name).then(async()=>await n()).finally(()=>u())}function m(){h(),a.updateProvider(r.name).then(async()=>await n()).finally(()=>u())}const E=d.exports.useMemo(()=>r.proxies.slice().sort((p,w)=>-1*De(p,w)),[r.proxies]);return e.createElement(J,{className:"proxy-provider"},e.createElement(Xe,{visible:c}),e.createElement("div",{className:"flex flex-col justify-between md:flex-row md:items-center "},e.createElement("div",{className:"flex items-center"},e.createElement("span",{className:"mr-6"},r.name),e.createElement(pe,null,r.vehicleType)),e.createElement("div",{className:"flex pt-3 items-center md:pt-0"},r.updatedAt&&e.createElement("span",{className:"text-sm"},`${l("providerUpdateTime")}: ${Se(new Date(r.updatedAt),o)}`),e.createElement(z,{className:"cursor-pointer text-red pl-5",type:"healthcheck",size:18,onClick:i}),e.createElement(z,{className:"cursor-pointer pl-5",type:"update",size:18,onClick:m}))),e.createElement("ul",{className:"proxies-list"},E.map(p=>e.createElement("li",{key:p.name},e.createElement(Ke,{className:"proxy-provider-item",config:p})))))}var Qe;(function(t){t[t.None=0]="None",t[t.Asc=1]="Asc",t[t.Desc=2]="Desc"})(Qe||(Qe={}));const nn={[0]:"sort",[1]:"sort-ascending",[2]:"sort-descending"};function De(t,n){const s=t.history.length>0?t.history.slice(-1)[0].delay:0;return((n.history.length>0?n.history.slice(-1)[0].delay:0)||Number.MAX_SAFE_INTEGER)-(s||Number.MAX_SAFE_INTEGER)}function sn(){const{groups:t,global:n}=de(),{data:s,set:o}=ze(),{general:a}=Ne(),{translation:r}=D(),{t:l}=r("Proxies"),c=d.exports.useMemo(()=>a.mode==="global"?[n]:t,[a,t,n]);return e.createElement(e.Fragment,null,c.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(K,{title:l("groupTitle")},e.createElement(Ye,{className:"cursor-pointer text-sm text-shadow-primary text-primary-600",checked:s.breakConnections,onChange:u=>o("breakConnections",u)},l("breakConnectionsText"))),e.createElement(J,{className:"my-2.5 p-0 md:my-4"},e.createElement("ul",{className:"list-none"},c.map(u=>e.createElement("li",{className:"proxies-group-item",key:u.name},e.createElement(en,{config:u})))))))}function on(){const{providers:t}=_e(),{translation:n}=D(),{t:s}=n("Proxies");return e.createElement(e.Fragment,null,t.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(K,{title:s("providerTitle")}),e.createElement("ul",{className:"list-none"},t.map(o=>e.createElement("li",{className:"my-2.5 md:my-4",key:o.name},e.createElement(tn,{provider:o}))))))}function an(){const{proxies:t}=de(),{translation:n}=D(),{t:s}=n("Proxies");function o(){ce.notifySpeedTest()}const{current:a,next:r}=zt([1,2,0]),l=d.exports.useMemo(()=>{switch(a){case 2:return t.slice().sort((u,h)=>De(u,h));case 1:return t.slice().sort((u,h)=>-1*De(u,h));default:return t.slice()}},[a,t]),c=r;return e.createElement(e.Fragment,null,l.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(K,{title:s("title")},e.createElement(z,{className:"ml-3",type:nn[a],onClick:c,size:20}),e.createElement(z,{className:"ml-3",type:"speed",size:20}),e.createElement("span",{className:"proxies-speed-test",onClick:o},s("speedTestText"))),e.createElement("ul",{className:"proxies-list"},l.map(u=>e.createElement("li",{key:u.name},e.createElement(Ke,{config:u}))))))}function rn(){return e.createElement("div",{className:"page"},e.createElement(sn,null),e.createElement(on,null),e.createElement(an,null))}function ln(t){const{update:n}=Ue(),{translation:s,lang:o}=D(),a=M(),{provider:r}=t,{t:l}=s("Rules"),{visible:c,hide:u,show:h}=Pe();function i(){h(),a.updateRuleProvider(r.name).then(async()=>await n()).finally(()=>u())}const m=g("rule-provider-icon",{"rule-provider-loading":c});return e.createElement("div",{className:"rule-provider"},e.createElement("div",{className:"rule-provider-header"},e.createElement("div",{className:"rule-provider-header-part"},e.createElement("span",{className:"rule-provider-name"},r.name),e.createElement(pe,null,r.vehicleType),e.createElement(pe,{className:"rule-provider-behavior"},r.behavior),e.createElement("span",{className:"rule-provider-update"},`${l("ruleCount")}: ${r.ruleCount}`)),e.createElement("div",{className:"rule-provider-header-part"},r.updatedAt&&e.createElement("span",{className:"rule-provider-update"},`${l("providerUpdateTime")}: ${Se(new Date(r.updatedAt),o)}`),e.createElement(z,{className:m,type:"update",size:18,onClick:i}))))}function cn(){const{providers:t}=Ue(),{translation:n}=D(),{t:s}=n("Rules");return e.createElement(e.Fragment,null,t.length!==0&&e.createElement("div",{className:"flex flex-col"},e.createElement(K,{title:s("providerTitle")}),e.createElement(J,{className:"divide-y rounded shadow-primary mt-4 p-0"},t.map(o=>e.createElement(ln,{key:o.name,provider:o})))))}function un(){const{rules:t,update:n}=Bt(),{translation:s}=D(),{t:o}=s("Rules");ee("rules",n);function a({index:r,style:l}){const c=t[r];return e.createElement("li",{className:"rule-item",style:l},e.createElement("div",{className:"flex py-1"},e.createElement("div",{className:"text-center w-40 rule-type"},c.type),e.createElement("div",{className:"flex-1 text-center payload"},c.payload),e.createElement("div",{className:"text-center w-40 rule-proxy"},c.proxy)))}return e.createElement("div",{className:"page"},e.createElement(cn,null),e.createElement(K,{className:"not-first:mt-7.5",title:o("title")}),e.createElement(J,{className:"flex flex-col flex-1 mt-2.5 p-0 md:mt-4 focus:outline-none"},e.createElement(ft,{className:"min-h-120"},({height:r,width:l})=>e.createElement(pt,{height:r,width:l,itemCount:t.length,itemSize:50},a))))}const mn=[{label:"\u4E2D\u6587",value:"zh_CN"},{label:"English",value:"en_US"}];function dn(){var U,j,L;const{premium:t}=me(),{data:n,update:s}=Ge(),{general:o,update:a}=Ne(),r=ye(Ce),l=le(),{translation:c,setLang:u,lang:h}=D(),{t:i}=c("Settings"),m=M(),[E,p]=fe({socks5ProxyPort:7891,httpProxyPort:7890,mixedProxyPort:0});d.exports.useEffect(()=>{var x,Q,ie;p("socks5ProxyPort",(x=o==null?void 0:o.socksPort)!=null?x:0),p("httpProxyPort",(Q=o==null?void 0:o.port)!=null?Q:0),p("mixedProxyPort",(ie=o==null?void 0:o.mixedPort)!=null?ie:0)},[o,p]);async function w(x){await m.updateConfig({mode:x}),await a()}async function F(x){await(k==null?void 0:k.setStartAtLogin(x)),await s()}async function $(x){await(k==null?void 0:k.setSystemProxy(x)),await s()}function B(x){u(x)}async function P(){await m.updateConfig({port:E.httpProxyPort}),await a()}async function W(){await m.updateConfig({"socks-port":E.socks5ProxyPort}),await a()}async function Y(){await m.updateConfig({"mixed-port":E.mixedProxyPort}),await a()}async function X(x){await m.updateConfig({"allow-lan":x}),await a()}const{hostname:q,port:_}=l,{allowLan:N,mode:C}=o,T=(U=n==null?void 0:n.startAtLogin)!=null?U:!1,R=(j=n==null?void 0:n.systemProxy)!=null?j:!1,A=(L=n==null?void 0:n.isClashX)!=null?L:!1,O=d.exports.useMemo(()=>{const x=[{label:i("values.global"),value:"Global"},{label:i("values.rules"),value:"Rule"},{label:i("values.direct"),value:"Direct"}];return t&&x.push({label:i("values.script"),value:"Script"}),x},[i,t]);return e.createElement("div",{className:"page"},e.createElement(K,{title:i("title")}),e.createElement(J,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.startAtLogin")),e.createElement(ve,{disabled:!(n==null?void 0:n.isClashX),checked:T,onChange:F})),e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.language")),e.createElement(Be,{options:mn,value:h,onSelect:x=>B(x)}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.setAsSystemProxy")),e.createElement(ve,{disabled:!A,checked:R,onChange:$})),e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.allowConnectFromLan")),e.createElement(ve,{checked:N,onChange:X})))),e.createElement(J,{className:"settings-card"},e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.proxyMode")),e.createElement(Be,{options:O,value:ht(C),onSelect:w})),e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.socks5ProxyPort")),e.createElement(se,{className:"w-28",disabled:A,value:E.socks5ProxyPort,onChange:x=>p("socks5ProxyPort",+x),onBlur:W}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.httpProxyPort")),e.createElement(se,{className:"w-28",disabled:A,value:E.httpProxyPort,onChange:x=>p("httpProxyPort",+x),onBlur:P})),e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.mixedProxyPort")),e.createElement(se,{className:"w-28",disabled:A,value:E.mixedProxyPort,onChange:x=>p("mixedProxyPort",+x),onBlur:Y}))),e.createElement("div",{className:"flex flex-wrap"},e.createElement("div",{className:"flex w-full py-3 px-8 items-center justify-between md:w-1/2"},e.createElement("span",{className:"font-bold label"},i("labels.externalController")),e.createElement("span",{className:g({"modify-btn":!A},"external-controller"),onClick:()=>!A&&r(!1)},`${q}:${_}`)),e.createElement("div",{className:"px-8 w-1/2"}))))}var fn="./assets/logo.b453e72f.png";function pn(t){const{routes:n}=t,{translation:s}=D(),{version:o,premium:a}=me(),{data:r}=Ge(),{t:l}=s("SideBar"),c=n.map(({path:u,name:h,noMobile:i})=>e.createElement("li",{className:g("item",{"no-mobile":i}),key:h},e.createElement(Et,{to:u,className:({isActive:m})=>g({active:m})},l(h))));return e.createElement("div",{className:"sidebar"},e.createElement("img",{src:fn,alt:"logo",className:"sidebar-logo"}),e.createElement("ul",{className:"sidebar-menu"},c),e.createElement("div",{className:"sidebar-version"},e.createElement("span",{className:"sidebar-version-label"},"Clash",(r==null?void 0:r.isClashX)&&"X"," ",l("Version")),e.createElement("span",{className:"sidebar-version-text"},o),a&&e.createElement("span",{className:"sidebar-version-label"},"Premium")))}function hn(){Ve();const t=[{path:"/proxies",name:"Proxies",element:e.createElement(rn,null)},{path:"/logs",name:"Logs",element:e.createElement(Qt,null)},{path:"/rules",name:"Rules",element:e.createElement(un,null),noMobile:!0},{path:"/connections",name:"Connections",element:e.createElement(qt,null),noMobile:!0},{path:"/settings",name:"Settings",element:e.createElement(dn,null)}];return e.createElement("div",{className:g("app",{"not-clashx":!ne()})},e.createElement(pn,{routes:t}),e.createElement("div",{className:"page-container"},e.createElement(yt,null,e.createElement(Te,{path:"/",element:e.createElement(xt,{to:"/proxies",replace:!0})}),t.map(n=>e.createElement(Te,{path:n.path,key:n.path,element:n.element})))),e.createElement(Kt,null))}function Ze(){const t=document.getElementById("root"),n=e.createElement(gt,null,e.createElement(d.exports.Suspense,{fallback:e.createElement(Xe,{visible:!0})},e.createElement(hn,null)));xe.exports.render(n,t)}ne()?Ct(()=>Ze()):Ze();
